<!-- =========================================================
     DASHBOARD.HTML – PART 1
     Core Layout & Header
     ---------------------------------------------------------
     - Main wrapper
     - Sidebar placeholder
     - Top bar with search & user actions
     - Responsive container setup
========================================================= -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Creator OS</title>
    <link rel="stylesheet" href="styles.css">
    <script src="app.js" defer></script>
</head>
<body>
    <div class="app-wrapper">

        <!-- Sidebar (will be dynamically populated via JS) -->
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar content: links to Dashboard, Creator DB, Campaigns, Teams, Analytics, etc. -->
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="back-header">
                    <h1>Dashboard</h1>
                    <div class="view-header-row">
                        <div class="search-container">
                            <input type="text" id="searchInput" placeholder="Search creators, campaigns...">
                        </div>
                        <div class="top-bar-actions">
                            <button class="btn" id="addCreatorBtn"><i class="icon-plus"></i> Add Creator</button>
                            <button class="btn" id="bulkUploadBtn"><i class="icon-upload"></i> Bulk Upload</button>
                            <button class="btn" id="exportSelectedBtn"><i class="icon-download"></i> Export</button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Sync / Toast placeholders -->
            <div class="sync-status" id="syncStatus"></div>
            <div class="toast" id="toastNotification"><i class="icon-check"></i><span id="toastMessage"></span></div>
<!-- =========================================================
     DASHBOARD.HTML – PART 2/7
     Creator Database Section
     ---------------------------------------------------------
     - Filters for niche, subniche, category, gender, state, city
     - Search input
     - Bulk upload option
     - Individual add option
========================================================= -->

            <!-- Creator Database Section -->
            <section class="creator-database-section">
                
                <!-- Filters -->
                <div class="creator-filters">
                    <select class="filter-select" id="filterNiche">
                        <option value="">All Niches</option>
                        <option>Fashion</option>
                        <option>Beauty & Skincare</option>
                        <option>Food</option>
                        <option>Fitness</option>
                        <option>Sports</option>
                        <option>Parenting</option>
                        <option>Travel</option>
                        <option>Comedy</option>
                        <option>Tech</option>
                        <option>Professionals</option>
                        <option>Performing Arts</option>
                        <option>Automobile</option>
                    </select>

                    <select class="filter-select" id="filterSubniche">
                        <option value="">All Subniches</option>
                        <option>Stylist</option>
                        <option>Designers</option>
                        <option>Reviewers</option>
                        <option>Luxury</option>
                        <option>Bloggers</option>
                        <option>Lifestyle</option>
                        <option>Make-up</option>
                        <option>Skincare</option>
                        <option>Nail Artist</option>
                        <option>Chefs</option>
                        <option>Homechefs</option>
                        <option>Recipe Creator</option>
                        <option>Mukbang</option>
                        <option>Healthy Recipe</option>
                        <option>Non Vegetarian</option>
                        <option>Baking</option>
                        <option>Gym</option>
                        <option>Yoga</option>
                        <option>Pillate</option>
                        <option>Zumba</option>
                        <option>Bodybuilders</option>
                        <option>Coach</option>
                        <option>Cricketers</option>
                        <option>Footballers</option>
                        <option>Hockey</option>
                        <option>Basketball</option>
                        <option>Runner</option>
                        <option>Surfer</option>
                        <option>Athlete</option>
                        <option>Mom</option>
                        <option>Dad</option>
                        <option>Senior Citizen</option>
                        <option>Kids</option>
                        <option>Actor</option>
                        <option>Doctor</option>
                        <option>Nutritionist</option>
                        <option>CA</option>
                        <option>Anchor</option>
                        <option>Architects</option>
                        <option>Photographer</option>
                        <option>Videographer</option>
                        <option>Journalist</option>
                        <option>Wedding Planner</option>
                        <option>Home Decor</option>
                        <option>Dancer</option>
                        <option>Singer</option>
                        <option>Musician</option>
                        <option>Poet</option>
                        <option>Story-Teller</option>
                        <option>Doodle Artist</option>
                        <option>DIY</option>
                        <option>Stand-Up</option>
                        <option>Skit</option>
                        <option>Vox-Pop</option>
                    </select>

                    <select class="filter-select" id="filterCategory">
                        <option value="">All Categories</option>
                        <option>Nano</option>
                        <option>Micro</option>
                        <option>Macro</option>
                        <option>Mega</option>
                    </select>

                    <select class="filter-select" id="filterGender">
                        <option value="">All Genders</option>
                        <option>Male</option>
                        <option>Female</option>
                        <option>Other</option>
                    </select>

                    <input type="text" class="filter-input" id="filterState" placeholder="State">
                    <input type="text" class="filter-input" id="filterCity" placeholder="City">
                </div>

                <!-- Creator Grid -->
                <div class="creators-grid" id="creatorsGrid">
                    <!-- Dynamically populated creator cards -->
                </div>

                <!-- Bulk Upload Modal Trigger -->
                <div id="bulkUploadModal" class="modal-overlay">
                    <div class="modal modal-medium">
                        <div class="modal-header">
                            <h2>Bulk Upload Creators (CSV)</h2>
                            <button class="modal-close" id="closeBulkUpload">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>Upload a CSV file with the following headings:</p>
                            <ul>
                                <li>Name</li>
                                <li>Link</li>
                                <li>Username</li>
                                <li>Followers</li>
                                <li>Niche</li>
                                <li>Subniche</li>
                                <li>Category</li>
                                <li>State</li>
                                <li>City</li>
                                <li>Contact No</li>
                                <li>Email</li>
                                <li>Gender</li>
                            </ul>
                            <input type="file" id="bulkCsvInput" accept=".csv">
                            <small>Optional: Avg reel views, Engagement, Commercials can be added later</small>
                        </div>
                        <div class="form-actions">
                            <button class="btn" id="uploadCsvBtn">Upload</button>
                            <button class="btn" id="cancelCsvBtn">Cancel</button>
                        </div>
                    </div>
                </div>

            </section>
<!-- =========================================================
     DASHBOARD.HTML – PART 3/7
     Creator Bookmarking & Export
     ---------------------------------------------------------
     - Bookmark creators to form a group
     - Export bookmarked creators to campaigns
     - Individual add creator modal
========================================================= -->

            <!-- Bookmarked Creators Toolbar -->
            <div class="bookmarked-toolbar">
                <button class="btn" id="viewBookmarked">View Bookmarked Creators</button>
                <button class="btn" id="exportBookmarked">Export to Campaign</button>
            </div>

            <!-- Export to Campaign Modal -->
            <div id="exportCampaignModal" class="modal-overlay">
                <div class="modal modal-medium">
                    <div class="modal-header">
                        <h2>Export Creators to Campaign</h2>
                        <button class="modal-close" id="closeExportModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <label for="selectCampaign">Select Campaign</label>
                        <select id="selectCampaign">
                            <option value="">Select a Campaign</option>
                            <!-- Dynamically populated with live campaigns -->
                        </select>
                        <p>You can also add creators directly here to the campaign.</p>
                        <div id="addCreatorsToCampaign">
                            <!-- Form or inputs to add creators individually -->
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn" id="confirmExportBtn">Export</button>
                        <button class="btn" id="cancelExportBtn">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Individual Add Creator Modal -->
            <div id="addCreatorModal" class="modal-overlay">
                <div class="modal modal-medium">
                    <div class="modal-header">
                        <h2>Add Individual Creator</h2>
                        <button class="modal-close" id="closeAddCreator">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="addCreatorForm">
                            <div class="form-group">
                                <label for="creatorName">Name</label>
                                <input type="text" id="creatorName" required>
                            </div>
                            <div class="form-group">
                                <label for="creatorLink">Link</label>
                                <input type="url" id="creatorLink">
                            </div>
                            <div class="form-group">
                                <label for="creatorUsername">Username</label>
                                <input type="text" id="creatorUsername" required>
                            </div>
                            <div class="form-group">
                                <label for="creatorFollowers">Followers</label>
                                <input type="number" id="creatorFollowers" required>
                            </div>
                            <div class="form-group">
                                <label for="creatorNiche">Niche</label>
                                <select id="creatorNiche">
                                    <option>Fashion</option>
                                    <option>Beauty & Skincare</option>
                                    <option>Food</option>
                                    <option>Fitness</option>
                                    <option>Sports</option>
                                    <option>Parenting</option>
                                    <option>Travel</option>
                                    <option>Comedy</option>
                                    <option>Tech</option>
                                    <option>Professionals</option>
                                    <option>Performing Arts</option>
                                    <option>Automobile</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="creatorSubniche">Subniche</label>
                                <select id="creatorSubniche">
                                    <option>Stylist</option>
                                    <option>Designers</option>
                                    <option>Reviewers</option>
                                    <option>Luxury</option>
                                    <option>Bloggers</option>
                                    <option>Lifestyle</option>
                                    <option>Make-up</option>
                                    <option>Skincare</option>
                                    <option>Nail Artist</option>
                                    <option>Chefs</option>
                                    <option>Homechefs</option>
                                    <option>Recipe Creator</option>
                                    <option>Mukbang</option>
                                    <option>Healthy Recipe</option>
                                    <option>Non Vegetarian</option>
                                    <option>Baking</option>
                                    <option>Gym</option>
                                    <option>Yoga</option>
                                    <option>Pillate</option>
                                    <option>Zumba</option>
                                    <option>Bodybuilders</option>
                                    <option>Coach</option>
                                    <option>Cricketers</option>
                                    <option>Footballers</option>
                                    <option>Hockey</option>
                                    <option>Basketball</option>
                                    <option>Runner</option>
                                    <option>Surfer</option>
                                    <option>Athlete</option>
                                    <option>Mom</option>
                                    <option>Dad</option>
                                    <option>Senior Citizen</option>
                                    <option>Kids</option>
                                    <option>Actor</option>
                                    <option>Doctor</option>
                                    <option>Nutritionist</option>
                                    <option>CA</option>
                                    <option>Anchor</option>
                                    <option>Architects</option>
                                    <option>Photographer</option>
                                    <option>Videographer</option>
                                    <option>Journalist</option>
                                    <option>Wedding Planner</option>
                                    <option>Home Decor</option>
                                    <option>Dancer</option>
                                    <option>Singer</option>
                                    <option>Musician</option>
                                    <option>Poet</option>
                                    <option>Story-Teller</option>
                                    <option>Doodle Artist</option>
                                    <option>DIY</option>
                                    <option>Stand-Up</option>
                                    <option>Skit</option>
                                    <option>Vox-Pop</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="creatorCategory">Category</label>
                                <select id="creatorCategory">
                                    <option>Nano</option>
                                    <option>Micro</option>
                                    <option>Macro</option>
                                    <option>Mega</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="creatorGender">Gender</label>
                                <select id="creatorGender">
                                    <option>Male</option>
                                    <option>Female</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button class="btn" type="submit">Add Creator</button>
                                <button class="btn" type="button" id="cancelAddCreator">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
<!-- =========================================================
     DASHBOARD.HTML – PART 4/7
     Campaigns Section & Creator Database Integration
     ---------------------------------------------------------
     - Running Campaigns
     - Live Campaigns
     - Converted Campaigns
     - Fix missing dropdown issue
     - Link campaigns to Creator Database
========================================================= -->

            <!-- Campaigns Section -->
            <div class="campaigns-section">
                <h3>Campaigns</h3>
                <div class="campaign-filters">
                    <select id="runningCampaignsDropdown">
                        <option value="">Select Running Campaign</option>
                        <!-- Dynamically populated -->
                    </select>

                    <select id="liveCampaignsDropdown">
                        <option value="">Select Live Campaign</option>
                        <!-- Dynamically populated -->
                    </select>

                    <select id="convertedCampaignsDropdown">
                        <option value="">Select Converted Campaign</option>
                        <!-- Dynamically populated -->
                    </select>
                </div>

                <div class="campaign-cards-grid" id="campaignCardsGrid">
                    <!-- Each campaign card dynamically rendered here -->
                </div>
            </div>

            <!-- Fix for Missing Dropdown Issue -->
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    const fetchCampaigns = async () => {
                        // Fetch campaigns from backend or storage
                        const campaigns = await getCampaigns(); // custom function
                        
                        const runningDropdown = document.getElementById("runningCampaignsDropdown");
                        const liveDropdown = document.getElementById("liveCampaignsDropdown");
                        const convertedDropdown = document.getElementById("convertedCampaignsDropdown");

                        // Clear previous options
                        [runningDropdown, liveDropdown, convertedDropdown].forEach(dd => dd.innerHTML = '<option value="">Select Campaign</option>');

                        campaigns.forEach(campaign => {
                            const option = `<option value="${campaign.id}">${campaign.name}</option>`;
                            if(campaign.status === "Running") runningDropdown.innerHTML += option;
                            else if(campaign.status === "Live") liveDropdown.innerHTML += option;
                            else if(campaign.status === "Converted") convertedDropdown.innerHTML += option;
                        });
                    };

                    fetchCampaigns();
                });

                // Handle linking selected creators from creator database
                const exportBookmarkedToCampaign = async (campaignId, creators) => {
                    if(!campaignId) return alert("Select a campaign first!");
                    try {
                        await addCreatorsToCampaign(campaignId, creators); // custom backend call
                        alert("Creators successfully added to campaign!");
                        // Optionally refresh campaign cards
                    } catch(e) {
                        console.error(e);
                        alert("Error adding creators to campaign");
                    }
                };
            </script>
<!-- =========================================================
     DASHBOARD.HTML – PART 5/7
     Creator Database – Bulk Upload & Table Integration
     ---------------------------------------------------------
     - Bulk upload CSV
     - Table to display creators
     - Bookmark & export to campaigns
========================================================= -->

            <!-- Creator Database Section -->
            <div class="creator-database-section">
                <h3>Creator Database</h3>

                <!-- Bulk Upload -->
                <div class="creator-bulk-upload">
                    <label for="bulkCsvUpload">Upload CSV (Name, Link, Username, Followers, Niche, Subniche, Category, State, City, Contact No, Email, Gender)</label>
                    <input type="file" id="bulkCsvUpload" accept=".csv" />
                    <button id="bulkUploadBtn">Upload</button>
                </div>

                <!-- Creator Search & Bookmark -->
                <div class="creator-search-bookmark">
                    <input type="text" id="creatorSearchInput" placeholder="Search creators..." />
                    <button id="viewBookmarkedBtn">View Bookmarked</button>
                </div>

                <!-- Creator Table -->
                <table id="creatorTable">
                    <thead>
                        <tr>
                            <th>Bookmark</th>
                            <th>Name</th>
                            <th>Username</th>
                            <th>Followers</th>
                            <th>Niche</th>
                            <th>Subniche</th>
                            <th>Category</th>
                            <th>State</th>
                            <th>City</th>
                            <th>Contact</th>
                            <th>Email</th>
                            <th>Gender</th>
                            <th>Avg Reel Views</th>
                            <th>Engagement</th>
                            <th>Commercials</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamically populated -->
                    </tbody>
                </table>

                <!-- Export to Campaign -->
                <div class="export-to-campaign">
                    <select id="exportCampaignSelect">
                        <option value="">Select Campaign</option>
                        <!-- Populated dynamically -->
                    </select>
                    <button id="exportCreatorsBtn">Export Bookmarked Creators</button>
                </div>
            </div>

            <!-- Bulk CSV Upload Script -->
            <script>
                document.getElementById("bulkUploadBtn").addEventListener("click", () => {
                    const fileInput = document.getElementById("bulkCsvUpload");
                    if(!fileInput.files.length) return alert("Select a CSV file first.");

                    const file = fileInput.files[0];
                    const reader = new FileReader();

                    reader.onload = (e) => {
                        const csvText = e.target.result;
                        const rows = csvText.split("\n").filter(r => r.trim() !== "");
                        const headers = rows.shift().split(",");

                        const creators = rows.map(row => {
                            const values = row.split(",");
                            const obj = {};
                            headers.forEach((header, i) => obj[header.trim()] = values[i]?.trim() || "");
                            return obj;
                        });

                        addCreatorsBulk(creators); // custom backend function
                        renderCreatorTable(creators);
                        alert("Creators added successfully!");
                    };

                    reader.readAsText(file);
                });

                // Render Creator Table
                const renderCreatorTable = (creators) => {
                    const tbody = document.querySelector("#creatorTable tbody");
                    tbody.innerHTML = "";
                    creators.forEach(c => {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                            <td><input type="checkbox" class="bookmark-checkbox" /></td>
                            <td>${c.Name}</td>
                            <td>${c.Username}</td>
                            <td>${c.Followers}</td>
                            <td>${c.Niche}</td>
                            <td>${c.Subniche}</td>
                            <td>${c.Category}</td>
                            <td>${c.States}</td>
                            <td>${c.City}</td>
                            <td>${c['Contact No']}</td>
                            <td>${c.Email}</td>
                            <td>${c.Gender}</td>
                            <td>${c['Avg Reel Views'] || ""}</td>
                            <td>${c.Engagement || ""}</td>
                            <td>${c.Commercials || ""}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                };

                // Export Bookmarked to Campaign
                document.getElementById("exportCreatorsBtn").addEventListener("click", () => {
                    const campaignId = document.getElementById("exportCampaignSelect").value;
                    if(!campaignId) return alert("Select a campaign first!");

                    const tableRows = document.querySelectorAll("#creatorTable tbody tr");
                    const bookmarkedCreators = [];
                    tableRows.forEach(tr => {
                        if(tr.querySelector(".bookmark-checkbox").checked) {
                            bookmarkedCreators.push({
                                Name: tr.cells[1].textContent,
                                Username: tr.cells[2].textContent,
                                Followers: tr.cells[3].textContent,
                                Niche: tr.cells[4].textContent,
                                Subniche: tr.cells[5].textContent,
                                Category: tr.cells[6].textContent,
                                State: tr.cells[7].textContent,
                                City: tr.cells[8].textContent,
                                Contact: tr.cells[9].textContent,
                                Email: tr.cells[10].textContent,
                                Gender: tr.cells[11].textContent
                            });
                        }
                    });

                    exportBookmarkedToCampaign(campaignId, bookmarkedCreators);
                });
            </script>
<!-- ========================================================
     Dashboard – Part 6/7
     Final Integration & Modals
========================================================= -->

<!-- Bulk Upload Modal -->
<div class="modal-overlay" id="bulkUploadModal">
    <div class="modal modal-large">
        <div class="modal-header">
            <h2>Bulk Upload Creators</h2>
            <button class="modal-close" onclick="closeModal('bulkUploadModal')">&times;</button>
        </div>
        <form id="bulkUploadForm">
            <div class="form-section">
                <h3><i class="fa fa-upload"></i> Upload CSV</h3>
                <input type="file" accept=".csv" id="creatorCsvFile" required>
                <small>CSV headings: Name, Link, Username, Followers, Niche, Subniche, Category, States, City, Contact No, Email, Gender</small>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('bulkUploadModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Upload</button>
            </div>
        </form>
    </div>
</div>

<!-- Restricted Access / Admin Modal -->
<div class="modal-overlay" id="accessModal">
    <div class="modal modal-small">
        <div class="modal-header">
            <h2>Manage Dashboard Access</h2>
            <button class="modal-close" onclick="closeModal('accessModal')">&times;</button>
        </div>
        <form id="accessForm">
            <div class="form-section">
                <h3><i class="fa fa-user-shield"></i> Assign Access</h3>
                <select id="accessUsers" multiple>
                    <!-- Dynamically populate users with admin privileges -->
                </select>
                <small>Hold Ctrl (Windows) / Cmd (Mac) to select multiple users</small>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('accessModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Creator Bookmark / Export Modal -->
<div class="modal-overlay" id="bookmarkModal">
    <div class="modal modal-medium">
        <div class="modal-header">
            <h2>Bookmark Creators / Export</h2>
            <button class="modal-close" onclick="closeModal('bookmarkModal')">&times;</button>
        </div>
        <div class="form-section">
            <h3><i class="fa fa-bookmark"></i> Selected Creators</h3>
            <ul id="bookmarkedCreatorsList">
                <!-- Dynamically populated -->
            </ul>
        </div>
        <div class="form-section">
            <h3><i class="fa fa-link"></i> Export to Campaign</h3>
            <select id="exportCampaignSelect">
                <!-- Populate with active campaigns -->
            </select>
        </div>
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeModal('bookmarkModal')">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="exportBookmarksToCampaign()">Export</button>
        </div>
    </div>
</div>

<!-- Notifications / Toasts -->
<div class="toast" id="toastNotification">
    <i class="fa fa-check-circle"></i>
    <span id="toastMessage">Success!</span>
</div>

<!-- Empty State / No Data -->
<div class="empty-state" id="emptyDashboardState" style="display:none;">
    <i class="fa fa-database"></i>
    <h3>No Creators Found</h3>
    <p>Start by adding creators individually or using the bulk upload.</p>
    <div class="empty-campaign-card" onclick="openModal('bulkUploadModal')">
        <i class="fa fa-upload"></i>
        <h4>Bulk Upload Creators</h4>
        <p>Click here to upload multiple creators via CSV</p>
    </div>
</div>

<script>
    // Utility to open modal
    function openModal(modalId) {
        document.getElementById(modalId).classList.add('active');
    }
    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }

    // Toast notification helper
    function showToast(message, type='success') {
        const toast = document.getElementById('toastNotification');
        const toastMsg = document.getElementById('toastMessage');
        toastMsg.innerText = message;
        toast.className = 'toast ' + (type === 'error' ? 'error' : '');
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Placeholder: Bulk Upload CSV handler
    document.getElementById('bulkUploadForm').addEventListener('submit', function(e){
        e.preventDefault();
        // Implement CSV parsing & adding to creator DB here
        closeModal('bulkUploadModal');
        showToast('Creators uploaded successfully!');
    });

    // Placeholder: Export bookmarks to campaign
    function exportBookmarksToCampaign() {
        const campaignId = document.getElementById('exportCampaignSelect').value;
        // Implement actual export logic here
        closeModal('bookmarkModal');
        showToast('Creators exported to campaign!');
    }
</script>
<!-- ********************************************************
   DASHBOARD.HTML – PART 7/7
   Functional JS & Integrations
   --------------------------------------------------------
   - Restricted Access
   - Bulk Creator Upload (CSV)
   - Creator Bookmarking
   - Export to Campaign
   - Optional Fields Handling
   - Event Listeners & Modals
**********************************************************-->

<script>
document.addEventListener("DOMContentLoaded", function () {

    /*********************
     * GLOBAL VARIABLES
     *********************/
    const creatorsDB = []; // Array of creator objects
    const bookmarks = new Set(); // Store bookmarked creator IDs
    let userRole = 'admin'; // Example role, set dynamically in real app

    /*********************
     * RESTRICTED ACCESS
     *********************/
    function checkAccess() {
        const dashboardSections = document.querySelectorAll('.restricted');
        dashboardSections.forEach(section => {
            if (userRole !== 'admin') {
                section.style.display = 'none';
            }
        });
    }
    checkAccess();

    /*********************
     * BULK CSV UPLOAD
     *********************/
    const csvInput = document.querySelector('#bulkCsvUpload');
    csvInput && csvInput.addEventListener('change', handleCSVUpload);

    function handleCSVUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const text = e.target.result;
            parseCSV(text);
        };
        reader.readAsText(file);
    }

    function parseCSV(csvText) {
        const lines = csvText.split("\n");
        const headers = lines[0].split(",").map(h => h.trim());
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i].trim()) continue;
            const values = lines[i].split(",").map(v => v.trim());
            const creator = {};
            headers.forEach((header, idx) => {
                creator[header] = values[idx] || "";
            });

            // Auto assign category based on followers
            const followers = parseInt(creator['Followers']) || 0;
            if (followers < 15000) creator['Category'] = 'Nano';
            else if (followers < 150000) creator['Category'] = 'Micro';
            else if (followers < 550000) creator['Category'] = 'Macro';
            else creator['Category'] = 'Mega';

            creatorsDB.push(creator);
        }
        renderCreators(creatorsDB);
    }

    /*********************
     * RENDER CREATORS
     *********************/
    const creatorsContainer = document.querySelector('.creators-grid');

    function renderCreators(list) {
        if (!creatorsContainer) return;
        creatorsContainer.innerHTML = '';
        list.forEach((c, idx) => {
            const card = document.createElement('div');
            card.classList.add('creator-card');
            card.innerHTML = `
                <div class="creator-card-header">
                    <img src="${c.Avatar || 'default-avatar.png'}" alt="" class="creator-avatar">
                    <div class="creator-info">
                        <h4>${c.Name}</h4>
                        <div class="creator-handle">
                            <a href="${c.Link}" target="_blank">${c.Username}</a>
                        </div>
                    </div>
                    <div>
                        <button class="bookmark-btn" data-idx="${idx}">
                            ${bookmarks.has(idx) ? '★' : '☆'}
                        </button>
                    </div>
                </div>
                <div class="creator-stats">
                    <div class="creator-stat"><span class="value">${c.Followers || '-'}</span><span class="label">Followers</span></div>
                    <div class="creator-stat"><span class="value">${c['Avg Reel Views'] || '-'}</span><span class="label">Avg Views</span></div>
                    <div class="creator-stat"><span class="value">${c.Engagement || '-'}</span><span class="label">Engagement</span></div>
                </div>
            `;
            creatorsContainer.appendChild(card);
        });

        attachBookmarkListeners();
    }

    /*********************
     * BOOKMARK CREATORS
     *********************/
    function attachBookmarkListeners() {
        const buttons = document.querySelectorAll('.bookmark-btn');
        buttons.forEach(btn => {
            btn.addEventListener('click', function() {
                const idx = parseInt(this.dataset.idx);
                if (bookmarks.has(idx)) bookmarks.delete(idx);
                else bookmarks.add(idx);
                renderCreators(creatorsDB); // re-render to update stars
            });
        });
    }

    /*********************
     * EXPORT BOOKMARKED CREATORS
     *********************/
    const exportBtn = document.querySelector('#exportBookmarks');
    exportBtn && exportBtn.addEventListener('click', function() {
        const selectedCreators = Array.from(bookmarks).map(idx => creatorsDB[idx]);
        if (selectedCreators.length === 0) {
            alert("No creators bookmarked.");
            return;
        }

        const campaign = prompt("Enter Campaign Name to Export:");
        if (!campaign) return;

        // Example: send to backend
        console.log("Exporting to campaign:", campaign, selectedCreators);
        alert(`${selectedCreators.length} creators exported to ${campaign}`);
    });

    /*********************
     * SEARCH FILTER
     *********************/
    const searchInput = document.querySelector('#creatorSearch');
    searchInput && searchInput.addEventListener('input', function() {
        const term = this.value.toLowerCase();
        const filtered = creatorsDB.filter(c => 
            c.Name.toLowerCase().includes(term) || 
            c.Username.toLowerCase().includes(term) ||
            c.Niche.toLowerCase().includes(term)
        );
        renderCreators(filtered);
    });

    /*********************
     * OPTIONAL FIELDS HANDLING
     *********************/
    creatorsDB.forEach(c => {
        if (!c['Avg Reel Views']) c['Avg Reel Views'] = '-';
        if (!c.Engagement) c.Engagement = '-';
        if (!c.Commercials) c.Commercials = '-';
    });

});
</script>
