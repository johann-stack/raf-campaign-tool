<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aflog Campaign Management System</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <script>
        if (localStorage.getItem('aflog_logged_in') !== 'true') window.location.href = 'index.html';
    </script>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header"><div class="logo"><i class="fas fa-rocket"></i><span>Aflog CMS</span></div></div>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <span class="nav-section-title">Dashboard</span>
                <a href="#" class="nav-item active" data-view="dashboard"><i class="fas fa-chart-line"></i><span>Analytics</span></a>
                <a href="#" class="nav-item" data-view="my-tasks"><i class="fas fa-tasks"></i><span>My Tasks</span></a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Pipeline Stages</span>
                <a href="#" class="nav-item" data-view="brands"><i class="fas fa-building"></i><span>All Brands</span><span class="badge" id="badge-brands">0</span></a>
                <a href="#" class="nav-item" data-view="hot"><i class="fas fa-fire"></i><span>Hot Brands</span><span class="badge hot" id="badge-hot">0</span></a>
                <a href="#" class="nav-item" data-view="warm"><i class="fas fa-temperature-half"></i><span>Warm Brands</span><span class="badge warm" id="badge-warm">0</span></a>
                <a href="#" class="nav-item" data-view="lost"><i class="fas fa-heart-crack"></i><span>Lost Brands</span><span class="badge lost" id="badge-lost">0</span></a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Campaigns</span>
                <a href="#" class="nav-item" data-view="converted"><i class="fas fa-exchange-alt"></i><span>Converted to Campaign</span></a>
                <a href="#" class="nav-item" data-view="campaigns"><i class="fas fa-bullhorn"></i><span>All Campaigns</span><span class="badge running" id="badge-campaigns">0</span></a>
                <a href="#" class="nav-item" data-view="running"><i class="fas fa-play-circle"></i><span>Running</span><span class="badge running" id="badge-running">0</span></a>
                <a href="#" class="nav-item" data-view="live"><i class="fas fa-broadcast-tower"></i><span>Live</span><span class="badge live" id="badge-live">0</span></a>
                <a href="#" class="nav-item" data-view="invoice"><i class="fas fa-file-invoice-dollar"></i><span>Invoice Stage</span></a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Resources</span>
                <a href="#" class="nav-item admin-only" data-view="creators"><i class="fas fa-user-star"></i><span>Creator Database</span></a>
                <a href="#" class="nav-item admin-only" data-view="manage-team"><i class="fas fa-users"></i><span>Manage Team</span></a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Settings</span>
                <a href="#" class="nav-item" id="airtable-settings"><i class="fas fa-database"></i><span>Airtable Sync</span></a>
                <a href="#" class="nav-item" id="logout-btn"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
            </div>
        </nav>
        <div class="sidebar-footer">
            <div class="user-info"><img src="" alt="User" id="user-avatar"><div class="user-details"><span class="user-name" id="current-user">User</span><span class="user-role" id="current-role">Role</span></div></div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="top-bar">
            <div class="search-container"><i class="fas fa-search"></i><input type="text" id="global-search" placeholder="Search brands, campaigns, creators..."></div>
            <div class="top-bar-actions">
                <button class="btn btn-secondary" id="add-task-btn"><i class="fas fa-plus"></i> Add Task</button>
                <button class="btn btn-primary" id="add-brand-btn"><i class="fas fa-plus"></i> Add Brand</button>
            </div>
        </header>

        <!-- DASHBOARD VIEW -->
        <section id="view-dashboard" class="view active">
            <div class="view-header"><h1>Analytics Dashboard</h1></div>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-icon blue"><i class="fas fa-building"></i></div><div class="stat-info"><span class="stat-value" id="stat-total">0</span><span class="stat-label">Total Brands</span></div></div>
                <div class="stat-card"><div class="stat-icon orange"><i class="fas fa-fire"></i></div><div class="stat-info"><span class="stat-value" id="stat-hot">0</span><span class="stat-label">Hot Brands</span></div></div>
                <div class="stat-card"><div class="stat-icon green"><i class="fas fa-bullhorn"></i></div><div class="stat-info"><span class="stat-value" id="stat-campaigns">0</span><span class="stat-label">Active Campaigns</span></div></div>
                <div class="stat-card"><div class="stat-icon purple"><i class="fas fa-user-star"></i></div><div class="stat-info"><span class="stat-value" id="stat-creators">0</span><span class="stat-label">Creators</span></div></div>
            </div>
        </section>

        <!-- CREATOR DATABASE VIEW (Restricted) -->
        <section id="view-creators" class="view">
            <div class="view-header">
                <div class="view-header-row">
                    <div><h1><i class="fas fa-user-star"></i> Creator Database</h1><p>Restricted to Admins</p></div>
                    <div class="action-btns">
                        <button class="btn btn-outline" id="export-selected-btn" style="display:none;"><i class="fas fa-share-square"></i> Export Selected</button>
                        <button class="btn btn-secondary" id="bulk-upload-btn"><i class="fas fa-file-csv"></i> Bulk Upload CSV</button>
                        <button class="btn btn-primary" id="add-creator-db-btn"><i class="fas fa-plus"></i> Add Creator</button>
                    </div>
                </div>
            </div>
            <div class="creator-filters">
                <select id="filter-niche" class="filter-select"><option value="">All Niches</option></select>
                <select id="filter-category" class="filter-select">
                    <option value="">All Categories</option>
                    <option value="Nano">Nano (<15k)</option>
                    <option value="Micro">Micro (<150k)</option>
                    <option value="Macro">Macro (<550k)</option>
                    <option value="Mega">Mega (>550k)</option>
                </select>
                <input type="text" id="filter-creator-search" class="filter-input" placeholder="Search by name or handle...">
            </div>
            <div class="creators-grid" id="creators-grid"></div>
        </section>

        <!-- OTHER VIEWS -->
        <section id="view-brands" class="view"><div class="view-header"><h1>All Brands</h1></div><div class="table-container"><table class="data-table"><thead><tr><th>Brand</th><th>POC</th><th>Budget</th><th>Status</th><th>Actions</th></tr></thead><tbody id="tbody-brands"></tbody></table></div></section>
        <section id="view-hot" class="view"><div class="view-header"><h1>Hot Brands</h1></div><div class="table-container"><table class="data-table"><thead><tr><th>Status</th><th>Brand</th><th>POC</th><th>Budget</th><th>Pipeline</th><th>Actions</th></tr></thead><tbody id="tbody-hot"></tbody></table></div></section>
        <section id="view-warm" class="view"><div class="view-header"><h1>Warm Brands</h1></div><div class="table-container"><table class="data-table"><thead><tr><th>Status</th><th>Brand</th><th>POC</th><th>Budget</th><th>Actions</th></tr></thead><tbody id="tbody-warm"></tbody></table></div></section>
        <section id="view-lost" class="view"><div class="view-header"><h1>Lost Brands</h1></div><div class="table-container"><table class="data-table"><thead><tr><th>Status</th><th>Brand</th><th>POC</th><th>Comments</th><th>Actions</th></tr></thead><tbody id="tbody-lost"></tbody></table></div></section>
        <section id="view-converted" class="view"><div class="view-header"><h1>Converted to Campaign</h1></div><div class="table-container"><table class="data-table"><thead><tr><th>Brand</th><th>Budget</th><th>Campaign Name</th><th>Actions</th></tr></thead><tbody id="tbody-converted"></tbody></table></div></section>
        
        <section id="view-campaigns" class="view"><div class="view-header"><h1>All Campaigns</h1></div><div class="campaigns-list-container" id="all-campaigns-list"></div></section>
        <section id="view-running" class="view"><div class="view-header"><h1>Running Campaigns</h1></div><div class="campaigns-list-container" id="running-campaigns-list"></div></section>
        <section id="view-live" class="view"><div class="view-header"><h1>Live Campaigns</h1></div><div class="campaigns-list-container" id="live-campaigns-list"></div></section>
        <section id="view-invoice" class="view"><div class="view-header"><h1>Invoice Stage</h1></div><div class="table-container"><table class="data-table"><tbody id="tbody-invoice"></tbody></table></div></section>
        
        <section id="view-my-tasks" class="view"><div class="view-header"><h1>My Tasks</h1></div><div class="tasks-board"><div class="task-column" id="col-todo"><h3>To Do</h3><div id="tasks-todo" class="task-list"></div></div><div class="task-column" id="col-progress"><h3>In Progress</h3><div id="tasks-progress" class="task-list"></div></div><div class="task-column" id="col-done"><h3>Completed</h3><div id="tasks-completed" class="task-list"></div></div></div></section>
        <section id="view-manage-team" class="view"><div class="view-header"><h1>Manage Team</h1><button class="btn btn-primary" id="add-member-btn">Add Member</button></div><div class="table-container"><table class="data-table"><thead><tr><th>Name</th><th>Role</th><th>Status</th><th>Actions</th></tr></thead><tbody id="tbody-team"></tbody></table></div></section>
        
        <!-- CAMPAIGN DETAIL VIEW -->
        <section id="view-campaign-detail" class="view">
            <div class="view-header">
                <div class="view-header-row">
                    <div class="back-header"><button class="btn btn-secondary back-btn" id="back-to-campaigns"><i class="fas fa-arrow-left"></i> Back</button><div><h1 id="cd-title">Campaign Name</h1><p id="cd-subtitle">Brand Name</p></div></div>
                    <button class="btn btn-primary" id="add-creator-to-campaign-btn"><i class="fas fa-user-plus"></i> Add Creator</button>
                </div>
            </div>
            <!-- Campaign Stats Row -->
            <div class="campaign-stats-row" id="cd-stats"></div>
            <!-- Creators List -->
            <div class="campaign-creators-list" id="campaign-creators-list"></div>
        </section>
    </main>

    <!-- NEW MODALS -->
    
    <!-- Bulk Upload Modal -->
    <div class="modal-overlay" id="bulk-upload-modal">
        <div class="modal">
            <div class="modal-header"><h2>Bulk Upload Creators</h2><button class="modal-close" onclick="closeModal('bulk-upload-modal')">×</button></div>
            <div class="form-grid" style="padding: 20px;">
                <p style="grid-column: 1/-1; color: var(--text-secondary); margin-bottom: 10px;">Upload a CSV file with the following headers (order doesn't matter, headers must match exactly):</p>
                <code style="grid-column: 1/-1; background: var(--bg-tertiary); padding: 10px; border-radius: 5px; font-size: 0.8rem; margin-bottom: 20px;">Name, Link, Username, Followers, Niche, Subniche, Category, States, City, Contact No, Email, Gender</code>
                <div class="form-group full-width"><input type="file" id="csv-file-input" accept=".csv"></div>
            </div>
            <div class="form-actions"><button class="btn btn-primary" onclick="processCSV()">Upload</button></div>
        </div>
    </div>

    <!-- Export to Campaign Modal -->
    <div class="modal-overlay" id="export-modal">
        <div class="modal">
            <div class="modal-header"><h2>Export Selected Creators</h2><button class="modal-close" onclick="closeModal('export-modal')">×</button></div>
            <div class="form-grid" style="padding: 20px;">
                <div class="form-group full-width">
                    <label>Select Target Campaign</label>
                    <select id="export-campaign-select"><option value="">Loading...</option></select>
                </div>
            </div>
            <div class="form-actions"><button class="btn btn-primary" onclick="processExport()">Export</button></div>
        </div>
    </div>

    <!-- Add Creator Modal (Single) -->
    <div class="modal-overlay" id="creator-modal">
        <div class="modal modal-large">
            <div class="modal-header"><h2>Add Creator</h2><button class="modal-close" onclick="closeModal('creator-modal')">×</button></div>
            <form id="creator-form">
                <div class="form-grid">
                    <div class="form-group"><label>Name</label><input type="text" id="c-name" required></div>
                    <div class="form-group"><label>Username</label><input type="text" id="c-username" required></div>
                    <div class="form-group"><label>Profile Link</label><input type="url" id="c-link" required></div>
                    <div class="form-group"><label>Followers</label><input type="number" id="c-followers" required onchange="autoUpdateCategory(this.value)"></div>
                    <div class="form-group"><label>Niche</label><select id="c-niche" onchange="updateSubniches()"></select></div>
                    <div class="form-group"><label>Sub-Niche</label><select id="c-subniche"><option value="">Select Niche First</option></select></div>
                    <div class="form-group"><label>Category</label><input type="text" id="c-category" readonly style="background: var(--bg-tertiary);"></div>
                    <div class="form-group"><label>Gender</label><select id="c-gender"><option>Male</option><option>Female</option><option>Other</option></select></div>
                    <div class="form-group"><label>State</label><input type="text" id="c-state"></div>
                    <div class="form-group"><label>City</label><input type="text" id="c-city"></div>
                    <div class="form-group"><label>Contact No</label><input type="text" id="c-contact"></div>
                    <div class="form-group"><label>Email</label><input type="email" id="c-email"></div>
                </div>
                <div class="form-actions"><button type="submit" class="btn btn-primary">Save Creator</button></div>
            </form>
        </div>
    </div>

    <!-- Brand Modal -->
    <div class="modal-overlay" id="brand-modal">
        <div class="modal">
            <div class="modal-header"><h2>Add Brand</h2><button class="modal-close" onclick="closeModal('brand-modal')">×</button></div>
            <form id="brand-form">
                <div class="form-grid">
                    <div class="form-group"><label>Brand Name</label><input type="text" id="b-name" required></div>
                    <div class="form-group"><label>POC Name</label><input type="text" id="b-poc" required></div>
                    <div class="form-group"><label>Email</label><input type="email" id="b-email" required></div>
                    <div class="form-group"><label>Budget</label><select id="b-budget"><option>High</option><option>Medium</option><option>Low</option></select></div>
                    <div class="form-group"><label>Status</label><select id="b-status"><option>Hot Brands</option><option>Warm Brands</option><option>Converted to Campaign</option></select></div>
                </div>
                <div class="form-actions"><button type="submit" class="btn btn-primary">Save Brand</button></div>
            </form>
        </div>
    </div>

    <!-- Campaign Modal -->
    <div class="modal-overlay" id="campaign-modal">
        <div class="modal">
            <div class="modal-header"><h2>New Campaign</h2><button class="modal-close" onclick="closeModal('campaign-modal')">×</button></div>
            <form id="campaign-form">
                <div class="form-grid">
                    <div class="form-group full-width"><label>Campaign Name</label><input type="text" id="cp-name" required></div>
                    <div class="form-group"><label>Brand</label><select id="cp-brand" required></select></div>
                    <div class="form-group"><label>Platform</label><select id="cp-platform"><option>Instagram</option><option>YouTube</option><option>Both</option></select></div>
                    <div class="form-group"><label>Status</label><select id="cp-status"><option>Planning</option><option>Running</option></select></div>
                </div>
                <div class="form-actions"><button type="submit" class="btn btn-primary">Create Campaign</button></div>
            </form>
        </div>
    </div>

    <div class="toast" id="toast"><i class="fas fa-check"></i><span id="toast-msg"></span></div>
    <script src="js/app.js"></script>
</body>
</html>
